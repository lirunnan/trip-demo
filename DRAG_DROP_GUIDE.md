# 🔄 拖拽重排序功能使用指南

## 功能概述
用户可以在时间表视图中直接拖拽景点卡片来重新安排游览顺序，系统会自动重新计算时间安排和路线。

## 🎯 如何使用

### 1. 进入时间表视图
- 生成行程后，点击顶部的 "📅 时间表" 切换到日程视图
- 确保拖拽功能已启用（默认开启）

### 2. 拖拽操作
- **拖拽手柄**：每个景点卡片左侧有 ⋮⋮ 图标，这是拖拽手柄
- **开始拖拽**：鼠标悬停在卡片上，光标会变成 🤏 抓取状态
- **拖拽目标**：可以拖拽到其他景点卡片上，或者拖拽到时间槽中

### 3. 放置规则
- **同一天内重排序**：拖拽景点到同一天的不同时间位置
- **跨天移动**：拖拽景点到其他天的时间槽（如果有多天行程）
- **自动插入**：放置位置会自动调整，景点会插入到最合适的位置

## ⚡ 自动功能

### 时间重新计算
拖拽完成后，系统会自动：
- 重新计算所有景点的开始和结束时间
- 更新时间槽显示（如：09:00 - 11:00）
- 保持每个景点的原始游览时长

### 路线优化
- AI 会生成路线调整的反馈信息
- 自动考虑交通和时间成本
- 在聊天界面显示优化建议

## 🎨 视觉反馈

### 拖拽过程中
- 被拖拽的卡片：半透明效果，轻微旋转
- 目标区域：蓝色高亮边框
- 时间槽：悬停时背景色变化

### 完成后
- 卡片位置即时更新
- 时间信息自动刷新
- AI 反馈消息出现在聊天中

## 📋 技术实现

### 核心组件
```typescript
// 拖拽状态管理
const { handleDragStart, handleDrop, recalculateSchedule } = useDragAndDrop()

// 时间重新计算
const updatedItinerary = recalculateSchedule(newItinerary)
```

### 时间计算逻辑
- **起始时间**：早上 9:00 开始
- **间隔计算**：每个景点间隔 2.5 小时
- **动态调整**：根据拖拽后的新顺序重新计算

### 数据结构
```typescript
interface Location {
  name: string
  duration: string
  startTime?: string    // 09:00
  endTime?: string      // 11:00  
  timeSlot?: string     // 09:00 - 11:00
}
```

## 🔧 故障排除

### 如果拖拽不工作
1. 确认在时间表视图中（不是地图视图）
2. 检查是否点击了拖拽手柄（⋮⋮ 图标）
3. 确保鼠标在卡片区域内

### 时间没有更新
- 拖拽完成后时间会自动重新计算
- 如果没有更新，刷新页面重试

### 跨天拖拽问题
- 目前支持跨天拖拽
- 景点会移动到目标天数中
- 原天数的其他景点时间会自动调整

## 💡 使用技巧

1. **精确放置**：拖拽到具体的时间槽，而不只是其他卡片上
2. **批量调整**：一次拖拽一个景点，系统会自动优化其他景点时间
3. **查看反馈**：拖拽后查看聊天界面中的AI优化建议
4. **全屏体验**：使用全屏时间表获得更好的拖拽体验

## 🚀 未来增强

- [ ] 支持多选景点同时拖拽
- [ ] 更精细的时间调整（15分钟间隔）
- [ ] 拖拽预览路线变化
- [ ] 撤销/重做拖拽操作